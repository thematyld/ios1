#!/bin/bash
POSIXLY_CORRECT=yes
ed=""
file=""
date=""

#---------------Error----------------#
error () {
   echo "$1" >&2
   exit	-1
}

#----------------Initialize---------------
[ $# -eq 0 ] && error "0 parameters!!"
[ $# -ge 4 ] && error "Too many parameters!!"


#---------------------EDITOR---CONFIGURATION----------------#

if [ ! -z "${EDITOR}" ]; then
  ed=$EDITOR
elif [ ! -z "$VISUAL" ]; then 
  ed=$VISUAL
else
  ed=vi
fi

#-------------------------------------WEDI_RC---Variable----------------------#

# If non initialize variable WEDI_RC 
if [[ -z "${WEDI_RC}" ]]; then 
   error "WEDI_RC hasn't path..."
elif [ ! -e "${WEDI_RC}" ]; then	# If not exist path $WEDI_RC
   echo "Wedi has set path, but invalid...Creating path.." >&2
   x="`dirname $WEDI_RC`"
   if [ ! -d $x ]; then   #If file without last word doesn't exist and it's folder
      mkdir $x
      touch $x/${WEDI_RC##*/}
   else
      touch $x/${WEDI_RC##*/} 
   fi
fi

#-----------------Read------
read_textfile () {
   while IFS='' read -r line; do
	items=$(echo $line | tr " " "\n")
	i=0
	for item in $items ; do
	   echo $item
	   ((i++))
	done
   done < "$1"

}

#------------------Function--Open-file-------
open_file_editor () { 
   if [ -f $file ]; then
      $ed $file 
   else
      error "File didn't exist !!"
   fi
}

#---------------Write--WEDI_RC---Configuration-------
write_log () {		#if WEDI_RC contains the same file
if grep -qi `readlink -f $1` $WEDI_RC; then
 str="`readlink -f ${1}` `date "+%y%m%d"` ${s##* }" 
else
  echo "Unsuccess"
  str="`readlink -f ${1}` `date "+%y%m%d"` 1"
  if [ -s $1 ]; then 		#if $1 is not empty
    echo $str >> $WEDI_RC
  else
    echo $str > $WEDI_RC
  fi
fi
}

#-------------------
par_EQ1 () {
  if [ -f ${arg1} ]; then
     file=${arg1}
     open_file_editor
     write_log $file
 # elif [ -d ${arg1} ]; then
  fi
}

par_EQ2 () {
   case ${arg1} in
    -m) file=${arg2}
	read_textfile $WEDI_RC
	;;
    -l) file=${arg2}
       #	write_log $file
	;;
     *) error "Invalid parameters. Use --help" 
	 ;;
   esac
}

par_EQ3 () {
   case ${arg1} in
    -a) file=$arg3
	;;
    -b) file=$arg3
	;;
     *) error "Invalid parameters. Use --help" 
 	;;
   esac
   date=$arg2
}

#---------------CASE----------
case $# in
    1) arg1=${1}
       par_EQ1
	;;
    2) arg1=${1}
       arg2=${2}
       par_EQ2
	;;
    3) arg1=${1}
       arg2=${2}
       arg3=${3}
       par_EQ3
	;;
esac

#--------------------------------------------
[ -d "$file" ] && echo "I'm folder"
[ -f "$file" ] && echo "I'm file"

